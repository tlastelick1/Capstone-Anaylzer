const axios=require("axios");const rax=require("retry-axios");var inquirer=require("inquirer");const config=require("./config.json");let token=config.token;var guildroles=[];var guildchannels=[];var newschannels=[];var webinterval=2000;var messages=[];var channelids=[];var webhooks=[];var oldchannelids=[];var webid=[];axios.defaults.baseURL= "https://discord.com/api/v8";async function checktoken(){ await  new Promise(async function(a0,a1){ await axios(`${"/users/@me"}`,{method:"GET",headers:{"Authorization":"Bot "+ token,"Content-Type":"application/json"},raxConfig:{retry:5,onRetryAttempt:(a2)=>{const a3=rax.getConfig(a2);console.log(`${"Retry attempt #"}${a3.currentRetryAttempt}${""}`)}}}).then((a6)=>{global.mainhead= {"Authorization":"Bot "+ token,"Content-Type":"application/json"};global.secondhead= {'Authorization':"Bot "+ token};a0()}).catch(async function(a8){ await axios(`${"/users/@me"}`,{method:"GET",headers:{"Authorization":token,"Content-Type":"application/json"},raxConfig:{retry:5,onRetryAttempt:(a2)=>{const a3=rax.getConfig(a2);console.log(`${"Retry attempt #"}${a3.currentRetryAttempt}${""}`)}}}).then((a6)=>{global.mainhead= {"Authorization":token,"Content-Type":"application/json"};global.secondhead= {'Authorization':token};a0()}).catch((a8)=>{(console.log("Error verifying token info"));a0()})})})}async function getguild(){ await axios(`${"/guilds/"}${guildid}${""}`,{method:"GET",headers:mainhead}).then(async function(a6){console.log("successfully fetched guild");if(a6.data.icon!== null){ await axios.get(`${"https://cdn.discordapp.com/icons/"}${a6.data.id}${"/"}${a6.data.icon}${".png?size=4096"}`,{responseType:"arraybuffer"}).then((a21)=>{Buffer.from(a21.data,"binary").toString("base64");global.guildicon= "data:image/png;base64,"+ Buffer.from(a21.data,"binary").toString("base64")})}else {global.guildicon= null};global.copiedguildid= a6.data.id;global.guildfeatures= a6.data.features;global.guildname= a6.data.name+ " | Cloned By Social404 On YT";global.guildexplicit= a6.data.explicit_content_filter;global.guildnotifications= a6.data.default_message_notifications;global.guildverification= a6.data.verification_level;global.afkid= a6.data.afk_channel_id;global.afktime= a6.data.afk_timeout;global.systemid= a6.data.system_channel_id;global.guildregion= a6.data.region;global.guildrules= a6.data.rules_channel_id;global.guildpublic= a6.data.public_updates_channel_id}).catch((a8)=>{console.log("error getting guild"+ a8)})}async function getroles(){ await axios(`${"/guilds/"}${guildid}${"/roles"}`,{method:"GET",headers:mainhead}).then(async function(a6){console.log("successfully fetched roles");a6.data.map(async function(a40){guildroles.push({"name":a40.name,"permissions":a40.permissions,"id":a40.id,"position":a40.position,"color":a40.color,"hoist":a40.hoist,"mentionable":a40.mentionable})});guildroles.sort((a48,a49)=>{return (a48.position> a49.position)?1:-1})}).catch((a8)=>{console.log("error getting roles"+ a8)})}async function getchannels(){ await axios(`${"/guilds/"}${guildid}${"/channels"}`,{method:"GET",headers:mainhead}).then(async function(a6){console.log("successfully fetched channels");a6.data.map(async function(a56){if(a56.type== 4){guildchannels.push({"name":a56.name,"type":a56.type,"id":a56.id,"parent_id":a56.parent_id,"permission_overwrites":a56.permission_overwrites,"nsfw":a56.nsfw,"pos":a56.position})}else {if(a56.type== 0){guildchannels.push({"name":a56.name,"type":a56.type,"id":a56.id,"parent_id":a56.parent_id,"permission_overwrites":a56.permission_overwrites,"topic":a56.topic,"nsfw":a56.nsfw,"rate_limit_per_user":a56.rate_limit_per_user,"po":a56.position})}else {if(a56.type== 2){guildchannels.push({"name":a56.name,"type":a56.type,"id":a56.id,"parent_id":a56.parent_id,"permission_overwrites":a56.permission_overwrites,"topic":a56.topic,"nsfw":a56.nsfw,"bitrate":a56.bitrate,"user_limit":a56.user_limit,"po":a56.position})}else {if(a56.type== 5){guildchannels.push({"name":a56.name,"type":0,"id":a56.id,"parent_id":a56.parent_id,"permission_overwrites":a56.permission_overwrites,"topic":a56.topic,"nsfw":a56.nsfw,"po":a56.position});newschannels.push({"name":a56.name,"type":a56.type,"id":a56.id,"parent_id":a56.parent_id,"po":a56.position})}}}}});guildchannels.sort((a48,a49)=>{return (a48.parent_id> a49.parent_id)?1:-1});guildchannels.sort((a48,a49)=>{return (a48.pos< a49.pos)?1:-1});guildchannels.sort((a48,a49)=>{return (a48.po> a49.po)?1:-1})}).catch((a8)=>{console.log("error getting channels"+ a8)})}async function createguild(){let a113=rax.attach(); await axios(`${"guilds"}`,{method:"POST",headers:secondhead,raxConfig:{retry:5,onRetryAttempt:(a2)=>{const a3=rax.getConfig(a2);console.log(`${"Retry attempt #"}${a3.currentRetryAttempt}${""}`)}},data:{"name":guildname,"icon":guildicon,"roles":guildroles,"channels":guildchannels,"region":guildregion,"verification_level":guildverification,"default_message_notifications":guildnotifications,"explicit_content_filter":guildexplicit,"afk_channel_id":afkid,"afk_timeout":afktime,"system_channel_id":systemid}}).then(async function(a6){console.log("created guild");global.newguildid= a6.data.id}).catch((a8)=>{console.log("error creating guild "+ a8)})}async function addcom(){let a113=rax.attach(); await axios(`${"guilds/"}${guildid}${""}`,{method:"PATCH",headers:secondhead,raxConfig:{retry:5,onRetryAttempt:(a2)=>{const a3=rax.getConfig(a2);console.log(`${"Retry attempt #"}${a3.currentRetryAttempt}${""}`)}},data:{"features":guildfeatures,"verification_level":guildverification,"default_message_notifications":guildnotifications,"explicit_content_filter":guildexplicit,"rules_channel_id":guildrules}}).then(async function(a6){console.log(a6.data)}).catch((a8)=>{console.log("error adding community "+ a8)})}async function create(){ await checktoken(); await getguild(); await getroles(); await getchannels(); await createguild()}async function scrapeoldc(){channelids= []; await axios(`${"/guilds/"}${copiedguildid}${"/channels"}`,{method:"GET",headers:secondhead}).then((a131)=>{console.log("successfully scraped old channels");a131.data.map((a56)=>{if(a56.type== 0|| a56.type== 5){oldchannelids.push({"name":a56.name,"type":a56.type,"id":a56.id,"parent_id":a56.parent_id,"permission_overwrites":a56.permission_overwrites,"topic":a56.topic,"nsfw":a56.nsfw,"rate_limit_per_user":a56.rate_limit_per_user,"po":a56.position})}});oldchannelids.sort((a48,a49)=>{return (a48.parent_id> a49.parent_id)?1:-1});oldchannelids.sort((a48,a49)=>{return (a48.pos< a49.pos)?1:-1});oldchannelids.sort((a48,a49)=>{return (a48.po> a49.po)?1:-1})})}async function scrapec(){channelids= []; await axios(`${"/guilds/"}${newguildid}${"/channels"}`,{method:"GET",headers:secondhead}).then((a131)=>{console.log("successfully scraped channels");a131.data.map((a159)=>{if(a159.type== 0|| a159.type== 5){channelids.push(a159.id)}})})}async function getmsgs(oldchannelids){messages= []; await axios(`${"/channels/"}${oldchannelids}${"/messages?limit=99"}`,{method:"GET",headers:secondhead,raxConfig:{retry:5,onRetryAttempt:(a2)=>{const a3=rax.getConfig(a2);console.log(`${"Retry attempt #"}${a3.currentRetryAttempt}${""}`)}}}).then(async function(a6){console.log("successfully fetched messages");a6.data.map(async function(a169){if(a169.type!== 7&& a169.type!== 8&& a169.type!== 9&& a169.type!== 10&& a169.type!== 11){messages.push({content:a169.content,username:a169.author.username,avatar_url:"https://cdn.discordapp.com/avatars/"+ a169.author.id+ "/"+ a169.author.avatar+ ".png",file:a169.attachments,embeds:a169.embeds,mentions:a169.mentions,mention_roles:a169.mention_roles,pinned:a169.pinned,mention_everyone:a169.mention_everyone,tts:a169.tts,timestamp:a169.timestamp,edited_timestamp:a169.edited_timestamp,flags:a169.flags,type:a169.type})}});messages.reverse()}).catch((a8)=>{console.log("error getting messages"+ a8)})}async function createwebhook(channelids){ await axios(`${"/channels/"}${channelids}${"/webhooks"}`,{method:"POST",headers:secondhead,data:{"name":"Replay"}}).then(async function(a6){console.log("successfully created webhook")}).catch((a8)=>{console.log("error creating webhook"+ a8)})}async function getweb(channelids){var a195=0;webhooks= []; await axios(`${"/channels/"}${channelids}${"/webhooks"}`,{method:"GET",headers:mainhead}).then((a196)=>{console.log("successfully fetched webhooks");a196.data.map((a198)=>{a195++;webhooks.push(`${"https://discord.com/api/webhooks/"}${a198.id}${"/"}`+ a198.token);webid.push(a198.id)})}).catch((a8)=>{console.log("error getting webhooks"+ a8)})}async function sendmsgs(webhooks){return  new Promise((a0,a1)=>{if(messages.length== 0){a0()};var a208=0;for(var a209=0;a209< messages.length;a209++){setTimeout(async function(a209){axios(webhooks,{method:"POST",headers:{'Content-Type':"application/json"},data:messages[a209],raxConfig:{retry:5,onRetryAttempt:(a2)=>{const a3=rax.getConfig(a2);console.log(`${"Retry attempt #"}${a3.currentRetryAttempt}${""}`)}}}).then(async function(a6){console.log(a6.status);a208++;if(a208>= messages.length){a0()}}).catch((a8)=>{console.log("error sending message"+ a8);a208++;if(a208>= messages.length){a0()}})},2000* a209,a209)}})}async function deleteweb(webid){ await axios(`${"/webhooks/"}${webid}${""}`,{method:"DELETE",headers:mainhead}).then((a196)=>{console.log("Successfully Deleted Webhook")}).catch((a8)=>{console.log("Failed To Delete Webhook")})}async function copymsgs(){ await scrapeoldc(); await scrapec(); await getmsgs(oldchannelids[2].id); await createwebhook(channelids[2]); await getweb(channelids[2]); await sendmsgs(webhooks[0]); await deleteweb(webid[0])}async function copy(oldchannelids,channelids,webhooks,webid){ await scrapeoldc(); await scrapec(); await getmsgs(oldchannelids); await createwebhook(channelids); await getweb(channelids); await sendmsgs(webhooks); await deleteweb(webid)}async function execute(oldchannelids,channelids,webhooks,webid){for(var a209=0;a209< 10;a209++){ await copy(oldchannelids[a209].id,channelids[a209],webhooks[0],webid[0])}}async function send(){ await scrapeoldc(); await scrapec();for(var a209=0;a209< channelids.length;a209++){ await getmsgs(oldchannelids[a209].id); await createwebhook(channelids[a209]); await getweb(channelids[a209]); await sendmsgs(webhooks[0]); await deleteweb(webid[a209])}}async function make(){ await create(); await send()}console.log(`${"		███╗   ██╗ ██████╗██╗      ██████╗ ███╗   ██╗███████╗████╗  ██║██╔════╝██║     ██╔═══██╗████╗  ██║██╔════╝██╔██╗ ██║██║     ██║     ██║   ██║██╔██╗ ██║█████╗  ██║╚██╗██║██║     ██║     ██║   ██║██║╚██╗██║██╔══╝  ██║ ╚████║╚██████╗███████╗╚██████╔╝██║ ╚████║███████╗╚═╝  ╚═══╝ ╚═════╝╚══════╝ ╚═════╝ ╚═╝  ╚═══╝╚══════╝Made By Social404Github: https://github.com/social404     Youtube: https://www.youtube.com/channel/UCXk0klxbjcVgGvYyKWLgtLg/Discord Server: https://discord.gg/UzTqHJQPSs                                                                                         		"}`);inquirer.prompt({type:"input",name:"guild",message:"ID of the Server You Want to Clone : "}).then(async function(a244){global.guildid= a244.guild;make()})